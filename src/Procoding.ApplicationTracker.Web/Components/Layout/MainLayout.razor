@using Microsoft.AspNetCore.Components.Authorization
@inherits LayoutComponentBase
@inject AuthenticationStateProvider AuthStateProvider
@inject NavigationManager NavigationManager;

<MudDialogProvider />
<MudThemeProvider />
<MudSnackbarProvider />


<MudLayout>
    <MudAppBar>

            <MudSpacer />
            @Name
            <MudMenu AnchorOrigin="Origin.BottomLeft" Icon="@Icons.Material.Filled.MoreVert">
                <MudMenuItem OnClick="Logout">Logout</MudMenuItem>
            </MudMenu>
    </MudAppBar>
    <MudDrawer Open="true" ClipMode="DrawerClipMode.Always">
        <MudPaper Width="250px" Class="py-3" Elevation="0">
            <MudNavMenu>
                <MudText Typo="Typo.h6" Class="px-4">Job application tracker</MudText>
                <MudText Typo="Typo.body2" Class="px-4 mud-text-secondary">Admin view</MudText>
                <MudDivider Class="my-2" />
                <MudNavLink Href="/">Home</MudNavLink>
                <MudNavLink Href="/job-applications">Job applications</MudNavLink>
                <MudNavLink Href="/candidates">Candidates</MudNavLink>
                <MudNavLink Href="/companies">Companies</MudNavLink>     
                <MudNavLink Href="/job-application-sources">Job application sources</MudNavLink>

            </MudNavMenu>
        </MudPaper>
    </MudDrawer>
    <MudMainContent Class="pl-5">
        @Body
    </MudMainContent>
</MudLayout>


<div id="blazor-error-ui">
    An unhandled error has occurred.
    <a href="" class="reload">Reload</a>
    <a class="dismiss">🗙</a>
</div>
@code {

    public string? Name { get; set; }

    protected async override Task OnInitializedAsync()
    {
        var authstate = await AuthStateProvider.GetAuthenticationStateAsync();
        var user = authstate.User;
        Name = user.Identity?.Name;
    }

    private void Logout()
    {
        NavigationManager.NavigateTo("/logout", true);
    }
}
